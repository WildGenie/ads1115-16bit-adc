//*************************************************************************************************
// DEBUT DU FICHIER
//*************************************************************************************************

//*************************************************************************************************
// Nom           : QueryPerformance.cs
// Auteur        : Nicolas Dagnas
// Description   : Déclaration de l'objet QueryPerformance
// Créé le       : 19/11/2017
// Modifié le    : 19/11/2017
//*************************************************************************************************

//-------------------------------------------------------------------------------------------------
#region Using directives
//-------------------------------------------------------------------------------------------------
using System;
using System.Runtime.InteropServices;
//-------------------------------------------------------------------------------------------------
#endregion
//-------------------------------------------------------------------------------------------------

//*************************************************************************************************
// Début du bloc "System.Diagnostics"
//*************************************************************************************************
namespace System.Diagnostics
{

    //   ###    #   #  #####  ####   #   #         ####   #####  ####   #####   ###   #### 
    //  #   #   #   #  #      #   #   # #          #   #  #      #   #  #      #   #  #   #
    //  #   #   #   #  ###    ####     #    #####  ####   ###    ####   ###    #   #  #### 
    //  #   #   #   #  #      #   #    #           #      #      #   #  #      #   #  #   #
    //   ### #   ###   #####  #   #    #           #      #####  #   #  #       ###   #   #  ##

    //*********************************************************************************************
    // Classe QueryPerformance
    //*********************************************************************************************
    #region // Déclaration et Implémentation de l'Objet
    //---------------------------------------------------------------------------------------------
    /// <summary>
    /// Permet le suivi précis du temps.
    /// </summary>
    //---------------------------------------------------------------------------------------------
    public class QueryPerformance
    {
        //-----------------------------------------------------------------------------------------
        [DllImport("Kernel32.dll")]
        private static extern bool QueryPerformanceCounter(out long value);
        //-----------------------------------------------------------------------------------------
        [DllImport("Kernel32.dll")]
        private static extern bool QueryPerformanceFrequency(out long value);
        //-----------------------------------------------------------------------------------------

        //-----------------------------------------------------------------------------------------
        // Section des Attributs
        //-----------------------------------------------------------------------------------------
        private long Ticks = 0;
        private long Frequency = 0;
        //-----------------------------------------------------------------------------------------

        //*****************************************************************************************
        /// <summary>
        /// Initialise une nouvelle instance de l'objet <b>QueryPerformance</b>.
        /// </summary>
        //-----------------------------------------------------------------------------------------
        private QueryPerformance() { QueryPerformanceFrequency(out this.Frequency); }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// Rend l'objet courant non initialisé.
        /// </summary>
        /// <returns>Objet courant.</returns>
        //-----------------------------------------------------------------------------------------
        public QueryPerformance Reset() { this.Ticks = 0; return this; }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// 
        /// </summary>
        /// <returns>Objet courant.</returns>
        //-----------------------------------------------------------------------------------------
        public QueryPerformance Snapshot()
        { QueryPerformanceCounter(out this.Ticks); return this; }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// Obtiens le temps écoulé à partir de l'initialisation de l'objet courant ou depuis le 
        /// dernier appel à la méthode <b>Snapshot</b>.
        /// </summary>
        //-----------------------------------------------------------------------------------------
        public long ElapsedMilliseconds
        {
            //-------------------------------------------------------------------------------------
            get
            {
                //---------------------------------------------------------------------------------
                if (this.Ticks == 0)
                    return long.MaxValue;

                long Value = 0;

                QueryPerformanceCounter(out Value);

                return (long)(((Value - this.Ticks) * 1000.0) / Frequency);
                //---------------------------------------------------------------------------------
            }
            //-------------------------------------------------------------------------------------
        }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// Obtiens une instance de l'objet <b>QueryPerformance</b> initialisé à maintenant.
        /// </summary>
        //-----------------------------------------------------------------------------------------
        public static QueryPerformance Now
        { get { return (new QueryPerformance()).Snapshot(); } }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// Obtiens une instance de l'objet <b>QueryPerformance</b> vide.
        /// </summary>
        //-----------------------------------------------------------------------------------------
        public static QueryPerformance Zero { get { return new QueryPerformance(); } }
        //*****************************************************************************************

        //*****************************************************************************************
        /// <summary>
        /// Indique si l'objet courant est non initialisé.
        /// </summary>
        //-----------------------------------------------------------------------------------------
        public bool IsEmpty { get { return this.Ticks == 0; } }
        //*****************************************************************************************
    }
    //---------------------------------------------------------------------------------------------
    #endregion
    //*********************************************************************************************

} // Fin du namespace "System.Diagnostics"
//*************************************************************************************************

//*************************************************************************************************
// FIN DU FICHIER
//*************************************************************************************************
